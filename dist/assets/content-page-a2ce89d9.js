import{j as t,r as a}from"./client-24a33b86.js";import{B as A,A as S,c as k,d as N,e as T,f as j,T as E,g as M,h as P,i as D}from"./common.constants-50715200.js";const I=({buttonPosition:u,sendSelectedDataToSidebar:x})=>t.jsxs("button",{id:"btnAddToKnowledgebase",className:"absolute z-50 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 py-2 px-3 flex items-center gap-x-1 font-medium transition-all delay-75 duration-100 ease-linear",style:{left:u.x,top:u.y+4},onClick:x,children:[t.jsx(A,{size:14,color:"white"}),t.jsx("span",{children:"Add to AutoAct"})]}),B=({id:u,label:x,placeHolder:b,selected:i,options:m,clearSelections:c,onSelection:p})=>{const[y,f]=a.useState(!1),[r,v]=a.useState(!0),[h,w]=a.useState(""),[s,l]=a.useState(0);return a.useEffect(()=>{const e=o=>{const g=o.composedPath()[0];g.id===u||g.closest(`#${u}`)||f(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),a.useEffect(()=>{const e=i.length!==0&&i[0]===S;v(e),l(e?m.length-1:Math.max(i.length-1,0))},[i,m]),a.useEffect(()=>{if(i.length===0||m.length===0)w(b);else if(r)w(m[0].value);else{const e=m.findIndex(o=>o.id===i[0]);w(e!==-1?m[e].value:b)}},[i,m,r]),t.jsx("div",{id:u,className:"multi-select relative",children:t.jsxs("div",{className:"flex flex-col gap-y-[10px]",children:[t.jsx("p",{className:"text-base font-medium text-gray-800",children:x}),t.jsxs("div",{className:`multi-select-box w-full py-3 px-4 rounded-lg text-black bg-[#fafafa] cursor-pointer flex items-center justify-between ${y?"border-2 border-blue-600":"border border-gray-300"}`,onClick:e=>{e.stopPropagation(),f(o=>!o)},children:[t.jsxs("div",{className:"flex-1 flex items-center",children:[t.jsx("span",{children:h}),s!==0&&t.jsxs("span",{style:{fontWeight:600,marginLeft:6},children:["+",s," more"]})]}),t.jsxs("div",{className:"flex items-center",children:[i.length!==0&&t.jsx(k,{size:20,title:"Clear Selections",onClick:e=>{e.stopPropagation(),c()}}),t.jsx("div",{className:"border-l border-l-gray-500",style:{marginLeft:6,paddingLeft:6},children:t.jsx(N,{size:18,fill:"#3E4784"})})]})]}),y&&t.jsx("div",{className:"multi-select-dropdown absolute left-0 border border-gray-300 shadow-sm text-black w-full overflow-hidden bg-white rounded-lg",style:{marginTop:92,maxHeight:112},children:t.jsx("div",{className:"overflow-y-auto",style:{maxHeight:112},children:m==null?void 0:m.map(e=>{const o=r||i.findIndex(g=>g===e.id)!==-1;return t.jsxs("div",{className:"px-4 py-2 w-full flex items-center cursor-pointer select-none transition-all delay-75 duration-150 ease-linear hover:bg-[#fafafa] hover:text-blue-600",style:{columnGap:8},onClick:g=>{g.stopPropagation(),p(e.id)},children:[o&&t.jsx(T,{size:18,color:"#2563eb"}),t.jsx("span",{className:"line-clamp-1",style:{marginLeft:o?0:26},children:e.value})]},e.id)})})})]})})},O=({isOpen:u,onClose:x,contexts:b})=>{const[i,m]=a.useState(""),[c,p]=a.useState([S]);a.useEffect(()=>{const r=v=>{const h=v.composedPath()[0];h.id===j||h.closest(`#${j}`)||h.id===E||h.closest(`#${E}`)||x()};return document.addEventListener("click",r),()=>document.removeEventListener("click",r)},[x]),a.useEffect(()=>{p([S])},[u]);const y=()=>{console.log("Selected Contexts:",c),console.log("Additional Info:",i)},f=a.useCallback(r=>{const v=(c==null?void 0:c[0])===S,h=c.includes(r);if(v){p(b.filter(s=>s.id!==r).map(s=>s.id));return}const w=h?c.filter(s=>s!==r):[...c,r];p(w.length===b.length?[S]:w)},[c,b]);return u?t.jsx("div",{className:"modal-overlay fixed inset-0 backdrop-blur-sm w-full h-full bg-black bg-opacity-50 flex justify-center items-center select-none",style:{zIndex:1e4},children:t.jsxs("div",{className:"modal bg-white rounded-lg w-full max-w-screen-sm flex flex-col gap-y-[18px] p-6",id:j,children:[t.jsxs("div",{className:"w-full flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-semibold text-black",children:"Run Action"}),t.jsx("button",{className:"icon-btn",onClick:x,children:t.jsx(k,{color:"gray",size:24})})]}),t.jsx(B,{id:"contexts",label:"Select contexts from knowledgebase:",placeHolder:"Select one or more contexts...",selected:c,options:b.map(r=>({id:r.id,value:r.title})),clearSelections:()=>p([]),onSelection:f}),t.jsxs("div",{className:"flex flex-col gap-y-[10px]",children:[t.jsx("label",{htmlFor:"additionalDetails",className:"text-base font-medium text-gray-800",children:"Add Additional Details:"}),t.jsx("textarea",{id:"additionalDetails",rows:2,className:"input-box",value:i,onChange:r=>m(r.target.value)})]}),t.jsx("button",{className:`${c.length===0?"btn-primary-disabled":"btn-primary"} self-end px-6`,onClick:y,disabled:c.length===0,children:"Run Task"})]})}):null},$=({contexts:u,openSidebar:x,removeSelection:b,openModal:i})=>{const[m,c]=a.useState(!1),[p,y]=a.useState(!1),f=()=>{const s=document.querySelectorAll("input, textarea");c(s.length>3)};a.useEffect(()=>{f();const s=new MutationObserver(()=>f());s.observe(document.body,{childList:!0,subtree:!0});const l=()=>{setTimeout(f,500)};window.addEventListener("popstate",l),window.addEventListener("hashchange",l);const e=()=>{document.hidden||f()};return document.addEventListener("visibilitychange",e),window.addEventListener("load",f),()=>{s.disconnect(),window.removeEventListener("popstate",l),window.removeEventListener("hashchange",l),document.removeEventListener("visibilitychange",e),window.removeEventListener("load",f)}},[]);const r=async()=>{try{y(!0);const s=window.location.hostname;console.log("domain",s);const l=document.documentElement.outerHTML;console.log("DOM HTML:",l);const e=u.map(d=>`${d.title}: ${d.description}`).join(`

`),o={dom:l,user_prompt:e||"Please understand this form and fill it with appropriate values.",custom_command:"Fill this form with values that make sense based on the form's purpose."},g=await fetch(`https://www.app.kleo.network/api/v1/form/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!g.ok)throw new Error(`API call failed with status: ${g.status}`);const n=await g.json();v(n),h("Form filled successfully!")}catch(s){console.error("Error in magic button process:",s),h("Failed to process the form. Please try again.",!0)}finally{y(!1),b()}},v=s=>{if(!Array.isArray(s)){console.error("Form elements is not an array:",s);return}s.forEach(l=>{if(!(!l.querySelectorInput||!l.value))try{const e=document.querySelectorAll(l.querySelectorInput);if(e.length===0){console.warn(`No elements found for selector: ${l.querySelectorInput}`);return}e.forEach(o=>{if(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement){o.value=l.value;const g=new Event("input",{bubbles:!0});o.dispatchEvent(g);const n=new Event("change",{bubbles:!0});o.dispatchEvent(n);const d=o.style.backgroundColor;o.style.backgroundColor="#e6f7ff",setTimeout(()=>{o.style.backgroundColor=d},1e3)}})}catch(e){console.error(`Error filling input ${l.querySelectorInput}:`,e)}})},h=(s,l=!1)=>{const e=document.createElement("div");e.textContent=s,e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.padding="12px 20px",e.style.borderRadius="4px",e.style.color="white",e.style.backgroundColor=l?"#f5222d":"#52c41a",e.style.boxShadow="0 3px 6px rgba(0, 0, 0, 0.16)",e.style.zIndex="10000",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s ease",setTimeout(()=>{document.body.removeChild(e)},500)},3e3)},w=()=>{chrome.runtime.sendMessage({action:"getSidebarState"},s=>{s&&s.isSidePanelOpen?s.contentType==="addNewContext"?x("contexts",!0):chrome.runtime.sendMessage({action:"closeSidePanel"}):x("contexts",!0)}),b()};return m?t.jsxs("div",{id:E,className:"buttons-wrapper fixed top-[42%] right-0 flex flex-col gap-y-1 bg-blue-600 w-fit p-1 rounded-tl-lg rounded-bl-lg",style:{zIndex:9999},children:[t.jsx("button",{className:`toolbar-btn ${p?"animate-pulse":""}`,title:p?"Processing...":"Magic Fill Form",onClick:r,disabled:p,children:t.jsx(M,{color:"white",size:30})}),t.jsx("button",{className:`toolbar-btn ${u.length===0?"hover:bg-blue-600":""}`,onClick:()=>{i(),b()},disabled:u.length===0,title:"Run",children:t.jsx(P,{color:u.length===0?"#ffffff3b":"white",size:30})}),t.jsx("button",{className:"toolbar-btn",onClick:w,title:"Knowledgebase",children:t.jsx(D,{color:"white",size:30})})]}):null},R=()=>{const[u,x]=a.useState(!1),[b,i]=a.useState(!1),[m,c]=a.useState({x:0,y:0}),[p,y]=a.useState({title:"",description:""}),[f,r]=a.useState([]),v=()=>{const n=window.getSelection(),d=(n==null?void 0:n.toString().trim())||"";if((d==null?void 0:d.length)!==0&&(n!=null&&n.rangeCount)){i(!1),y({title:document.title,description:d});const L=n.getRangeAt(0),C=L.getBoundingClientRect();c({x:C.left+window.scrollX,y:C.bottom+window.scrollY}),i(!0)}},h=n=>{const d=n.composedPath()[0];d.id==="btnAddToKnowledgebase"||d.closest("#btnAddToKnowledgebase")||i(!1)},w=()=>{setTimeout(()=>{var d;((d=window.getSelection())==null?void 0:d.toString().trim())||i(!1)},0)},s=()=>{chrome.runtime.sendMessage({action:"getContexts"},n=>{n&&!n.error&&r(n.data)})},l=n=>{n.action==="refetchContexts"&&s()};a.useEffect(()=>(s(),chrome.runtime.onMessage.addListener(l),document.addEventListener("mouseup",v),document.addEventListener("mousedown",h),document.addEventListener("click",w),()=>{chrome.runtime.onMessage.removeListener(l),document.removeEventListener("mouseup",v),document.removeEventListener("mousedown",h),document.removeEventListener("click",w)}),[]);const e=()=>{var n;(n=document.getSelection())==null||n.removeAllRanges(),i(!1)},o=(n,d=!1)=>{chrome.runtime.sendMessage({action:"openSidePanel",contentType:n,notifySidePanel:d})},g=()=>{e(),chrome.runtime.sendMessage({action:"scrappedPageData",pageData:p}),o("addNewContext",!0)};return t.jsxs("div",{className:"font-inter",children:[t.jsx(O,{isOpen:u,onClose:()=>x(!1),contexts:f}),b&&t.jsx(I,{buttonPosition:m,sendSelectedDataToSidebar:g}),t.jsx($,{contexts:f,openSidebar:o,removeSelection:e,openModal:()=>x(!0)})]})};export{R as default};
